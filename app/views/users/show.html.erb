<%# imports pop up js file %>
<%= javascript_include_tag "pop_up", "data-turbolinks-track" => true  %>
<%= render(partial: 'layouts/header') %>
<div class="page-section flexbox vertical stretch">
  <div class="section-inner flexbox vertical stretch">
    <div class="section-title-centered">
      Hello, <%= @user.first %>!
    </div>
    <div ="container">
      <div class="row">
          <div class="column">
          <%# display number of hours a user has biked in whole hours %>
          <h1>Congrats, you have biked <%= @user.hours.truncate() %> hours! </h1>
          </div>
          <div class="column">
          <div class="left">
            <div class="button">
              <%= link_to('Edit Profile', edit_user_path(current_user)) %>
            </div>
            <div class="button" onclick="popup()">
              Delete Profile
            </div>
            <%# <div class="button"> %>
              <%# <%= button_to('Delete Profile', user_path, method: :delete) %>
            <%# </div>%> <br>
            <br><h1>User Info</h1>
            <div class="flexbox">
              First Name: <%= @user.first %>
            </div>
            <div class="flexbox">
              Last Name: <%= @user.last %>
            </div>
            <div class="flexbox">
              Email: <%= @user.email %>
            </div>
            <div class="flexbox">
              <%# shows balance to 2 decimal places, even if it is a whole number %>
              Balance: $<%= sprintf("%.2f", @user.balance) %>
            </div>
            <script src="https://js.stripe.com/v3/"></script>
            <div class="button">
              <button id="checkout-button">Add Funds</button>
            </div>
          </div>
        </div>
      </div>
      <div id="popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); text-align: right">
        <div style="text-align: left;">
          <h1>Would you like to delete your profile?</h1>
          <p>We hoped you enjoyed your time with Valet Bike.</p>
            <div style="display: flex; justify-content: space-around; margin: 0% 25%">
              <%# button to close popup%>
              <div class="button return" onclick="close_popup()">
                Close
              </div>
              <%# button to go through with profile deletion %>
              <div class="button">
              <%= button_to('Delete Profile', user_path, method: :delete) %>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('checkout-button').addEventListener('click', function () {
    fetch('/create-checkout-session', {
      method: 'POST',
    })
    .then(function (response) {
      return response.json();
    })
    .then(function (sessionId) {
      const stripe = Stripe('pk_test_51QNfAeBdC2IsMXiiJsPSWF48k3gGuIBYmYKqgkutlHrlfbedYz8oLDUPuApV8J4iVdFL0R0kP2zpgw8vQvxgXgjd00eo57lWba'); // Replace with your Stripe publishable key
      stripe.redirectToCheckout({ sessionId: sessionId.id });
    })
    .catch(function (error) {
      console.error("Error:", error);
    });
  });
</script>